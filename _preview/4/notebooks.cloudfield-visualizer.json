{"version":2,"kind":"Notebook","sha256":"af491bcf956e15808148ed35b0dfdbff5b5c5de6a9deae4dfdf3d6b75a465d16","slug":"notebooks.cloudfield-visualizer","location":"/notebooks/cloudfield_visualizer.ipynb","dependencies":[],"frontmatter":{"title":"Visualizing the cloud-capped boundary layer","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/vapor-python-cookbook","copyright":"2024","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/vapor-python-cookbook/blob/HEAD/notebooks/cloudfield_visualizer.ipynb","exports":[{"format":"ipynb","filename":"cloudfield_visualizer.ipynb","url":"/vapor-python-cookbook/_preview/4/build/cloudfield_visualize-c8b13bf05877c2acaa28c3fc71a4cb60.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data is from a large eddy simulation of trade cumulus clouds.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ufgNMffkZp"}],"key":"xzn0wcxKEu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Single timestep at 12.5 m x, y, z grid spacing","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oMio0oW36r"}],"key":"PknQBvHavy"}],"key":"Y6SfguKNBe"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Variable is QN -- cloud liquid water (g/kg)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CsIk3uDa7y"}],"key":"m4bZ9w0iiY"}],"key":"nBzEZT0i3J"}],"key":"SSBLGmI9x8"}],"key":"QhxK87XhgN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"link to data file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aoF5DjWXun"}],"identifier":"link-to-data-file","label":"link to data file","html_id":"link-to-data-file","implicit":true,"key":"Lepeae3qnI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The netcdf file:  bomex_qv_qn.nc -- 527 Mbytes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ssPyrP0nuy"}],"key":"fTDVT3uRzO"},{"type":"comment","value":" [https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing](https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing) ","key":"b8DWSRHGSm"}],"key":"GeLKz4aXn4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nfrom pathlib import Path\nfrom vapor import session, renderer, dataset, camera","key":"eux91BMpyQ"},{"type":"output","id":"fzOtWYL4iLGNV2-VVAQYo","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxarray\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxr\u001b[39;00m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mpathlib\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m Path\n\u001b[32m      3\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m session, renderer, dataset, camera\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'xarray'","ename":"ModuleNotFoundError","evalue":"No module named 'xarray'"}],"key":"NV0MNOJs6g"}],"key":"c3WpUojhda"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"adjust path to point to file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QFTuatpHQZ"}],"identifier":"adjust-path-to-point-to-file","label":"adjust path to point to file","html_id":"adjust-path-to-point-to-file","implicit":true,"key":"IGD9yomXVu"}],"key":"yPRent6zH7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"the_file = Path().resolve() / 'bomex_qv_qn.nc'\nprint(the_file)\nthe_file.exists()","key":"KCCPa1kFZ5"},{"type":"output","id":"urCB8efK3uAlmYfj533ND","data":[],"key":"nXwyGudej1"}],"key":"DIGeMcFa9c"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspect the xarray dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wSsggj6x7U"}],"identifier":"inspect-the-xarray-dataset","label":"Inspect the xarray dataset","html_id":"inspect-the-xarray-dataset","implicit":true,"key":"TDnG6VImS6"}],"key":"uC1mqSUSst"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bomex_data = xr.open_dataset(the_file)\nbomex_data","key":"PZHMDp3r3x"},{"type":"output","id":"S4J5BDvIvgAc99Q71qRiW","data":[],"key":"FRwODz2y5A"}],"key":"E9Tjwibb4F"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"open as a Vapor dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W86wPfYoQE"}],"identifier":"open-as-a-vapor-dataset","label":"open as a Vapor dataset","html_id":"open-as-a-vapor-dataset","implicit":true,"key":"h2b6zGxR83"}],"key":"jIjGMncLhw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ses = session.Session()\ndata = ses.OpenDataset(dataset.CF, [str(the_file)])\nses.Load('session.vs3')","key":"nwOHOcKL3n"},{"type":"output","id":"HkrgBs-2RCMRKmIwt00b7","data":[],"key":"zp2F9MuGti"}],"key":"ubom3g2Lj4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Time Coordinate Variable Name:\", data.GetTimeCoordVarName())\nprint(\"Coordinate Variable Names:\", data.GetCoordVarNames())\n\nprint(\"Dimensions:\")\nfor dim in data.GetDimensionNames():\n    print(f\"  {dim}:\", data.GetDimensionLength(dim, 0))\n\nprint(\"Data Variables:\")\nfor var in data.GetDataVarNames():\n    print(f\"  {var}\")\n    print(f\"    Time Varying:\", bool(data.IsTimeVarying(var)))\n    print(f\"    Dimensionality:\", data.GetVarGeometryDim(var))\n    print(f\"    Coordinates:\", data.GetVarCoordVars(var, True))\n    print(\"     Data Range:\", data.GetDataRange(var))","key":"VcTvIfvgkb"},{"type":"output","id":"gM29KAI8Lfsm7oGkVeYFR","data":[],"key":"G8HNdaPJnu"}],"key":"xoj3XqPwda"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Show gridcells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q5PLf1kTql"}],"identifier":"show-gridcells","label":"Show gridcells","html_id":"show-gridcells","implicit":true,"key":"zYiIuM3smU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Red: watervapor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jczQ62T9TT"}],"key":"UTI0LNH0W1"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Grey: cloud liquid water","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"loAAEHoPv1"}],"key":"NHTRTxgLYZ"}],"key":"sle9eDqazD"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Top view of cloud field, with condensation threshold set to 0.01 g/kg","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"aZ2a26dvi4"}],"key":"pSWMWgvqEM"}],"key":"Ds5aTaQHy8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ren = data.NewRenderer(renderer.VolumeIsoRenderer)\nren.SetVariableName(data.GetDataVarNames(3)[0]) # Set to first 3D data variable\nren.SetIsoValues([0.01])\n\nses.GetCamera().ViewAll()\nses.Show()","key":"Sg46RqiN2v"},{"type":"output","id":"DekRW21TJeNDePzSryjQV","data":[],"key":"MSX2PXiIOq"}],"key":"sr36K0IjYk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create visualizer widget","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"poXKSa8eCR"}],"identifier":"create-visualizer-widget","label":"Create visualizer widget","html_id":"create-visualizer-widget","implicit":true,"key":"cx8uIDUQm9"}],"key":"WG3wDuexrK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from jupyter_vapor_widget import *\n\nviz = VaporVisualizerWidget(ses)\nviz","key":"zOkfHr5Hnm"},{"type":"output","id":"Qqu2npZ2XEEcA4ymRC-zK","data":[],"key":"FrDQnrOUlf"}],"key":"LqBrd6RUZj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Add a slider bar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KFPHSn932z"}],"identifier":"add-a-slider-bar","label":"Add a slider bar","html_id":"add-a-slider-bar","implicit":true,"key":"xg5BF6Y5aZ"}],"key":"hz1RDGR78G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tf = ren.GetPrimaryTransferFunction()\ndataRange = tf.GetMinMaxMapValue()\n\ndef sliderChanged(change):\n    ren.SetIsoValues([change.new])\n    viz.Render(fast=True)\n\nslider = widgets.FloatSlider(value=ren.GetIsoValues()[0], min=dataRange[0], max=dataRange[1], step=(dataRange[1]-dataRange[0])/100)\nslider.observe(sliderChanged, names='value')\n\nwidgets.VBox([\n    viz,\n    widgets.HBox([widgets.Label(\"Iso value:\"), slider])\n])","key":"gMLfyJbSY3"},{"type":"output","id":"n9EezMv-D42WWEdV2_UUT","data":[],"key":"yFKLGyXvsE"}],"key":"yMvICX2Uc5"}],"key":"Vs8pQs20tg"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Generic Workflow","url":"/notebooks/workflow-example","group":"Example workflows"}}},"domain":"http://localhost:3000"}