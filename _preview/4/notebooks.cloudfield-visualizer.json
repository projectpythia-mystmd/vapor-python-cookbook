{"version":2,"kind":"Notebook","sha256":"af491bcf956e15808148ed35b0dfdbff5b5c5de6a9deae4dfdf3d6b75a465d16","slug":"notebooks.cloudfield-visualizer","location":"/notebooks/cloudfield_visualizer.ipynb","dependencies":[],"frontmatter":{"title":"Visualizing the cloud-capped boundary layer","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/vapor-python-cookbook","copyright":"2024","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/vapor-python-cookbook/blob/HEAD/notebooks/cloudfield_visualizer.ipynb","exports":[{"format":"ipynb","filename":"cloudfield_visualizer.ipynb","url":"/vapor-python-cookbook/_preview/4/build/cloudfield_visualize-8ca0dccc077068aa46f146dadefced41.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data is from a large eddy simulation of trade cumulus clouds.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mpK8IbmH3K"}],"key":"B1WfPV9DAA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Single timestep at 12.5 m x, y, z grid spacing","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OJ6FuXrq1q"}],"key":"QmALCY18b5"}],"key":"fl4Wii1kC8"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Variable is QN -- cloud liquid water (g/kg)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"baZZblhiYj"}],"key":"S15N5G6Bp8"}],"key":"cfrjNma6YM"}],"key":"LbP33XZBJR"}],"key":"EtWaHg5FZn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"link to data file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GnNUhTNnAK"}],"identifier":"link-to-data-file","label":"link to data file","html_id":"link-to-data-file","implicit":true,"key":"fN6Ry2VG0o"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The netcdf file:  bomex_qv_qn.nc -- 527 Mbytes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FsecPtz1vC"}],"key":"cQgj9dvTwW"},{"type":"comment","value":" [https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing](https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing) ","key":"gL1x4NYuRs"}],"key":"pVnN1hLn6d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nfrom pathlib import Path\nfrom vapor import session, renderer, dataset, camera","key":"AIhmy9u8c3"},{"type":"output","id":"ZLu4fulsZAXaS2mTvmN7G","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxarray\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxr\u001b[39;00m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mpathlib\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m Path\n\u001b[32m      3\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m session, renderer, dataset, camera\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'xarray'","ename":"ModuleNotFoundError","evalue":"No module named 'xarray'"}],"key":"keHedC3gAB"}],"key":"CKiNiVqCuM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"adjust path to point to file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"s34K0pDWHm"}],"identifier":"adjust-path-to-point-to-file","label":"adjust path to point to file","html_id":"adjust-path-to-point-to-file","implicit":true,"key":"smP6JAp7Hn"}],"key":"ubNEvI2rBB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"the_file = Path().resolve() / 'bomex_qv_qn.nc'\nprint(the_file)\nthe_file.exists()","key":"hTfXzEBHC6"},{"type":"output","id":"hRr8bpGrx5Dbjc0MSZc8K","data":[],"key":"A5HGXl7gFH"}],"key":"Z1Yj6uJYeX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspect the xarray dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TuwFZGWos5"}],"identifier":"inspect-the-xarray-dataset","label":"Inspect the xarray dataset","html_id":"inspect-the-xarray-dataset","implicit":true,"key":"dN4NsS6u1P"}],"key":"CU1LmvlO4m"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bomex_data = xr.open_dataset(the_file)\nbomex_data","key":"OEkDytPwNo"},{"type":"output","id":"WAxnIQIf0eh9KTPTXIsuo","data":[],"key":"G44k6sEKWA"}],"key":"UwmIAd1ofu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"open as a Vapor dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UHiVLbPaOi"}],"identifier":"open-as-a-vapor-dataset","label":"open as a Vapor dataset","html_id":"open-as-a-vapor-dataset","implicit":true,"key":"CFXHl8tvDo"}],"key":"WJlLCgiSYS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ses = session.Session()\ndata = ses.OpenDataset(dataset.CF, [str(the_file)])\nses.Load('session.vs3')","key":"BFmAxuDxo9"},{"type":"output","id":"c9Y0ea9pB9bTM2dBa3CXj","data":[],"key":"WYbiUBeM6A"}],"key":"ss1WiKrt0K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Time Coordinate Variable Name:\", data.GetTimeCoordVarName())\nprint(\"Coordinate Variable Names:\", data.GetCoordVarNames())\n\nprint(\"Dimensions:\")\nfor dim in data.GetDimensionNames():\n    print(f\"  {dim}:\", data.GetDimensionLength(dim, 0))\n\nprint(\"Data Variables:\")\nfor var in data.GetDataVarNames():\n    print(f\"  {var}\")\n    print(f\"    Time Varying:\", bool(data.IsTimeVarying(var)))\n    print(f\"    Dimensionality:\", data.GetVarGeometryDim(var))\n    print(f\"    Coordinates:\", data.GetVarCoordVars(var, True))\n    print(\"     Data Range:\", data.GetDataRange(var))","key":"VR3iBURhTk"},{"type":"output","id":"eccF8FeLqDCPKfH7vOxvE","data":[],"key":"ZBoiFYAptH"}],"key":"NNnjVmfY16"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Show gridcells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UQcU0VIETe"}],"identifier":"show-gridcells","label":"Show gridcells","html_id":"show-gridcells","implicit":true,"key":"h5TZhqJsDt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Red: watervapor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dI5Ofjcb1p"}],"key":"NDBXNIpjny"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Grey: cloud liquid water","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ozxogluKS7"}],"key":"hxsOE6S34F"}],"key":"ABcVM3ggLz"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Top view of cloud field, with condensation threshold set to 0.01 g/kg","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"DRtSEbz02K"}],"key":"WdUcXOOitC"}],"key":"CR8GVoL6t4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ren = data.NewRenderer(renderer.VolumeIsoRenderer)\nren.SetVariableName(data.GetDataVarNames(3)[0]) # Set to first 3D data variable\nren.SetIsoValues([0.01])\n\nses.GetCamera().ViewAll()\nses.Show()","key":"BN1hs4NJzU"},{"type":"output","id":"YZJzWGf8kD_7Ix90BaPDs","data":[],"key":"kBy9cZoyEP"}],"key":"aSER6EVe45"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create visualizer widget","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"krBpxIDEZT"}],"identifier":"create-visualizer-widget","label":"Create visualizer widget","html_id":"create-visualizer-widget","implicit":true,"key":"E73ZDvFLl1"}],"key":"GPFBPY1q67"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from jupyter_vapor_widget import *\n\nviz = VaporVisualizerWidget(ses)\nviz","key":"OOJvU4GZ1n"},{"type":"output","id":"N728ilevLRMOsK_YZ17HF","data":[],"key":"dtBVOYz1Bj"}],"key":"doHfLaSQs4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Add a slider bar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FVt17gpuVV"}],"identifier":"add-a-slider-bar","label":"Add a slider bar","html_id":"add-a-slider-bar","implicit":true,"key":"eoDwETkCrb"}],"key":"bJJzhiiakH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tf = ren.GetPrimaryTransferFunction()\ndataRange = tf.GetMinMaxMapValue()\n\ndef sliderChanged(change):\n    ren.SetIsoValues([change.new])\n    viz.Render(fast=True)\n\nslider = widgets.FloatSlider(value=ren.GetIsoValues()[0], min=dataRange[0], max=dataRange[1], step=(dataRange[1]-dataRange[0])/100)\nslider.observe(sliderChanged, names='value')\n\nwidgets.VBox([\n    viz,\n    widgets.HBox([widgets.Label(\"Iso value:\"), slider])\n])","key":"dKA85pn8p7"},{"type":"output","id":"NQBwGDMNloiu2wZhCRbxI","data":[],"key":"D5eBcEriBe"}],"key":"hbZZmZYOJH"}],"key":"jJYFRxmLMh"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Generic Workflow","url":"/notebooks/workflow-example","group":"Example workflows"}}},"domain":"http://localhost:3000"}